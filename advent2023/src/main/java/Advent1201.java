import org.apache.commons.lang3.StringUtils;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

class Advent1201 {
    public static void main(String[] args) {
        String input = """
                ???.### 1,1,3
                .??..??...?##. 1,1,3
                ?#?#?#?#?#?#?#? 1,3,1,6
                ????.#...#... 4,1,1
                ????.######..#####. 1,6,5
                ?###???????? 3,2,1""";

        /*String input = """
                #?#????????.?#. 4,1,2,1
                .???#??.???????. 4,3
                ????#??.#. 1,4,1
                ???????#?#?.??#. 7,2
                ???#???..??#? 2,1,3
                ?#???.#????#??. 3,1,1,4
                ??#???.??#???#?# 2,3,4
                ???????#?#?#??#??. 1,10,2
                ??.??????#???.?# 1,1,3,1,2
                ?.????##?? 3,2,1
                .??#??????#?## 1,1,3,4
                ..#???###???# 7,1,1
                ?#?.??????.???#???#? 1,4,8
                ?.????????#?????. 1,5,5,1
                #??.?...??? 3,1
                ?.#?????#???. 3,3
                #????????? 2,6
                ??#??#??...?# 8,1
                ???#?##...??????.#?? 6,2,2,2
                .??#?#???.##???? 6,4
                .????#?.??.?? 1,4,1
                ???#???#?##?????#.? 4,10
                #?#.????##??#?#?. 3,11
                #.?#?##?????? 1,5,4
                ???#????.?#?#?.?? 1,2,3,5,1
                ??#?##??.???? 6,1
                #???#?????#.???.?? 11,1,1
                .#?#????##?# 1,1,1,4
                ?????##.??? 3,2,2
                #?###????.???????#? 5,1,1,2,1,1
                ????..???#.?? 3,4
                ?????????.??# 1,1,4,2
                .???##.#.#??? 1,3,1,3
                ??#??#..??.?? 3,2,2,1
                ?.??#?#?#?#? 1,7
                #?????.?????#??????? 4,1,7,1
                .???.???????#??.?#?? 3,8,1,2
                ?###.?#?#????#????? 4,1,1,1,3,2
                ???.#??#??? 1,4
                ?.???...#??#. 1,2,1,1
                ??????.????? 1,1,1,1
                ??#???..??..?.??. 5,1,1,2
                ??#.?##???.?.???#?? 3,6,2,1,1
                ?#????.???#??????. 2,1,7,1
                ??????.??????????. 3,3
                .?#?????.??#. 2,1,1,2
                ?#???#???##?##?..#?? 2,2,6,1
                #???????#?. 3,1,2
                ????.??..? 1,1,1
                #??..?##?.??.?#? 3,4,2
                ?#?#.??.?????#?? 4,1,7
                ??##.????##?.#?????? 4,1,3,4,1
                ???????.??? 2,2,3
                ?.???.##.?? 1,2,2
                ??.##?????..?#???? 6,2
                ???#??#???###????#.? 12,2
                ??????????.#?????#.? 1,2,1,5,1,1
                #.????.?.??#??? 1,2,5
                .?.??.??.? 1,1
                ????##??##????#??? 4,8
                ?#????#??????..? 4,1,4,1
                .?##..???####?#???? 2,11
                ????#????##??. 2,1,4
                ???.??#?## 1,3,2
                #??#?????## 1,5,2
                #???????#?????#?..# 10,2,1,1
                ..##?.?????#???#? 2,1,7
                ????.???##.? 1,1,3
                ?#???????????? 1,1,2,3
                ?????####.?#? 7,2
                ?.##??#??#? 2,2,3
                ????#????. 1,4
                .?#???????##?#??.??? 5,1,3,1,1,3
                .???.??.#??.?? 1,1,3,1
                ??????.??????? 5,1,1,3
                ?#?.??.?.###... 2,1,3
                ????.???##????. 4,5
                ??.??.#???##?#?.#? 1,1,1,4,1,1
                #.????.#.??????#??? 1,1,1,1,8
                ?#.??????.?#. 1,1,2,1
                .#?.??.#??#???? 1,1,1,2,3
                #?#?????#?#?.? 3,5
                ?#?.???#???# 1,6
                #??????????. 1,1,1,1
                ??????#??? 1,7
                ???#????##? 4,4
                ?.#?????.??#???? 1,2,1,4
                ?????????????## 1,1,2,5
                .?##?#.???#. 5,3
                ???.#??#?#?#??#?##?? 1,16
                ?.?.#.???????#?? 1,1,1,9
                .#?.?????.??. 1,3
                ?.?.?.??????#.# 1,1,1,2,1
                ???#??????????# 4,3,1,1,1
                ????#.?#.?.? 1,1,1,1
                #??.##????#???????? 3,4,1,2
                .?????#????#???? 2,1,6
                ??##?????#.????. 8,1,1
                .???#????? 1,3
                ????.???????#?? 1,6,1,1
                ..??.#??#.?.?.??? 4,1
                ??#??.???#???? 3,6
                ???.?#?????????#. 2,5
                #?#???.#???#?? 1,1,1,3
                ??#..???.? 1,1
                ??.???..??#?????? 2,6
                ?#?###??.?#?.#? 1,3,2,1
                ????.#.????##?## 1,1,2,6
                #????#??#.##??#?.? 1,6,5,1
                ??#????.##??. 2,1,3
                ??.??.?#??????? 1,4
                ???#?.???.??? 2,2,1
                .?#????#??.#?#??.#.? 7,1,1,1,1,1
                ?..??#????.?##.? 5,2
                ??.??##?##?????????? 1,11,1
                ???.?#?##????#??# 3,9,2
                ???.??##??? 1,1,6
                ?#?##.?###??.#? 4,4,2
                ??..##????#?#? 1,2,5
                ???#.?.#.?? 4,1,1
                ????###.????...#?? 6,1,1,1,1
                ..#?#?#??#?#???#?.?. 5,7
                ????#??#??.?.??.?# 5,1,2
                ..#??#..#???????. 4,1,2,2
                ???.?#???#.?##?# 3,2,2,5
                ?#??#????#? 1,3,3
                #?#???#.?.. 1,5,1
                ??????#??#.? 1,1,4,1
                .?????.????...? 3,2
                ??##????#???.?.????# 7,1,2,2
                ???##.?#.? 2,1
                ???.???.???## 1,2,1,3
                .???#??#??? 3,4
                ???#??.#??? 5,2,1
                #???.#???? 3,1,2
                .?????##?##?????.. 10,2
                ??????.#?###?#?# 1,1,1,9
                ??#????????????? 6,2
                ???##??#???#???#? 2,9
                #??#????#??#?##??? 1,1,1,1,6,1
                ????#??##????????. 5,5
                ??#?.#?.#?#????. 1,1,7
                .#?.#.??.#???.???# 1,1,1,4,1,1
                ?.#.??.##?#??#??? 1,9
                ???????.??##????. 1,1,4,3
                ??????.?#?#?#?. 1,1,2,1,1
                ?.?#????.?.??##.?. 5,2
                ?.#.??#??#???#??. 1,10
                ????.#????###????#? 1,1,9,4
                ????.?.?#? 2,3
                .#??..???#? 2,4
                ?.???????#?. 1,1,3
                ??.???#?#? 1,3,1
                .?#?????????? 4,3
                ?.??..??.??.#?.#? 2,1,2,2
                ??#????.?#?? 5,2
                ?????????.??? 2,1,3,1
                ?.#??.????.? 3,2
                ?#?.?#?#?##?#?? 1,10
                ???#??.???.?#?#. 5,1,3
                ###??#.#?.????.#??? 3,1,1,1,1,2
                .???#.????. 2,2
                .????.??????? 3,3
                ????..#?.# 4,1,1
                ?#.???.??????? 2,2,1,1
                ?????#??..? 1,4,1
                .??.#.??#????#????. 1,11
                ???#????#?????## 1,8,1,2
                ??#..??#?? 1,3
                .?#???.???? 2,2
                ?????????.? 1,1,2
                .?.???#?#..#? 6,1
                ???#????#???.?. 5,3
                ??#??????.????? 4,1,1
                ??.?##?#??? 2,2,2
                ??.?....?#???..? 1,4
                ??.#?????..???? 1,5,1,1
                .?#?????????#?#?#?? 16,1
                .???#???#??.?????#?? 7,6
                ?.?#..?#??? 1,3,1
                ?##??.?????.????#?. 5,2,5
                .?????#?????#????? 1,1,4,2,1
                .???????.???#??????? 3,3,10
                #..????#???.?? 1,7,1
                ?.#?#???#???# 3,2,1
                ?????#.?.???. 2,2,1,3
                ?#??#???.??? 2,2,1,3
                ?##?.?#?##?#.????#? 2,7,4
                ?#??????#???????##.? 13,3
                ????#??#?? 2,2,3
                .????.#.??????. 1,2
                ????##??#?????.?? 1,4,2,2,2
                ?.?#?.??????#??.#?? 1,1,1,6,3
                ??#?????##?#?????#? 3,1,8,1
                ????###????.?# 1,4,1,2
                ?????????#?????? 2,1,2,4
                ?#.??###?#???.#???.? 2,8,4
                ??.?#?#????. 1,6,1
                ????#????.# 4,2,1
                #??.?????????#????? 3,1,5,2,1,1
                ?#??.?.?#?# 1,1,3
                ???????????##?? 4,3
                ???#???#???.?????.. 10,3
                ?#?????#??.#???? 7,1,2,1
                ?.??.?????? 1,4
                ?#??????#.?###?..??? 8,4
                ??#????.?#????? 7,5
                ?#???????????#? 1,7,2
                .##???.#??###?????#? 2,1,1,5,2
                .#???.???#?????.? 4,1,1,1,1
                ??.?##?##??? 2,5,1
                ?.###???#? 4,2
                ????#?..#. 1,1,1
                ??##????#?.? 7,1
                .????#?..??#???????. 2,2,1,1,5
                ??????.??????????#? 1,1,6,2,1
                ?#???.????#. 4,5
                .???#??##??# 1,8
                ????????#.???#.??? 9,1,2
                ????#????????? 3,5
                ..#?##?.#?#.???? 5,1,1,2
                ????.???... 1,2
                ?.#?#?##?.?????#? 7,2,1
                ??.?????????. 1,7
                ????#.?.#####???? 4,9
                .?????.???.?..##??. 2,3,3
                ????.????. 1,1,1
                ???????#???? 1,1,5
                #??..??#.?.. 3,2
                ?.?????????#??????#? 1,2,3,10
                ???..?#?.????# 2,1,4
                ??#.????##??????.??# 2,1,5,4,1,1
                ?#?###????#?.?.#.? 12,1
                ???#?#???#..???.?? 1,1,2,2,1,1
                ?#????????? 4,1,3
                .?????##?.??.#?# 2,5,1,3
                ???#??#.#???.#? 1,1,1,2,1
                ###??#??????????.?# 6,7,1
                ????.?##?#? 1,1,5
                #?#???????#? 3,4,2
                ??#??#???#?#???????. 3,2,5,2
                ????#????##??.#??? 1,8,2
                ??????????.??. 1,3,1,1
                ?..??????.? 1,2
                ???##?..#? 1,3,2
                ??????.?????????#? 4,1,1,3,1
                .????.#.#?? 2,1,1
                ?????.???.???? 3,3,2
                #??.??#?#?.??#. 1,1,4,1
                ?#?#?##?#?##?###??? 1,16
                ??.?#???????## 5,4
                #????????.?#?? 1,2,4,1
                ???????#?.? 4,3
                ???##??.???????? 3,1,4
                #??????.?#?#?????#.# 4,1,9,1
                ??##?#???.???... 7,2
                .?.?.?#.???#?. 2,2
                ???#??????#?.#??# 1,9,4
                ?..???????? 3,1
                ?#?#?????? 1,2,1
                .????.??.?.??? 4,1,1,1
                ?????#????. 4,3,1
                ?.?..??????#??.?? 1,9
                ???????????#???#?#?? 2,3,7,3
                ???.???#???#?.? 1,5
                ?????..??..?? 5,2,1
                ?#?.???.?? 2,2
                ?????#??..??????##?? 6,2
                ?????.?#???#####?##? 1,12
                ????.#..??.????##?? 1,1,1,1,6
                ???#.?#??? 1,1,1
                ?.????#??#????#. 1,1,7,2
                .?????#?#?? 1,3,1
                ?#???##?####????? 1,8,1,1
                .???#?.?????#?? 5,5
                ?#.?.???..#..? 1,1
                ???.???#?#? 1,5
                ....?#????#.??. 7,1
                ??????#???#??? 3,7
                .????##?.??#?#??.??? 7,4,1
                ??.???##?#???##???#. 1,5,1,3,1,1
                ???.#...?#? 2,1,1
                .?.??#.????#???.???? 1,4,3
                ?##????#??#???? 2,5,3
                ????##?##.?.?.#???. 8,1,3
                ????????#? 2,1,3
                ???.????##????#??? 1,14
                #?.????????#??#?#.. 1,1,1,1,4,1
                ?.?#???#???#??#??#? 1,15
                #???.????#????.? 3,6
                ?#???.???#??.? 1,1,6
                ???#?.#?#??. 1,1,1,2
                ????##???# 1,2,2
                .???.????#??.?#? 2,6,1
                ???##.??...#? 5,1,1
                ?..?????###??? 1,1,6
                ??????..?#####.??##? 2,1,6,4
                ????#??.?#??????? 7,3,2
                ??###????.???? 6,1
                ?????.??.? 1,1
                ????????#???.???? 2,1,5,1
                .#??.?#???. 3,2,1
                ?#.???????? 1,3,1
                ?#?#??????.? 4,2
                ?.??##?###??##??#?#. 1,9,7
                .???#?#??.#?.?? 8,1,1
                ??.?#??#??????#????? 1,5,1,2,1,1
                .??.#???????? 1,2,1,1
                ?.?##?##.? 5,1
                ??.???#?.?? 1,4,1
                ?????????#??##??##? 1,1,1,10
                ?#???#.#??? 2,1,1
                #????????? 1,7
                ??.?#?#??#.?? 2,3,2,2
                ??..#????.?#???. 1,3
                ??????????..#?#??? 2,6
                .#?.??????##?? 2,4
                ?????#.??.????#.?. 1,3,1,2,1,1
                ?.????#?#?.???.#???? 1,7,1,1,2
                .?.???##??#####??? 1,13
                ?.??????.?#?????? 5,5
                ?..?.???#??#?.? 1,1,4,1
                .??.#?.????? 2,1,1,1
                ..###?#???#? 6,1
                #.????.#???????#? 1,1,1,8
                ??????#????.???#.?? 1,8,1,2,1
                ??##?#???#. 5,1
                ??????##.???? 1,3,2
                ?#.????#??#???????? 2,10,2
                ???#?????????? 4,1,6
                ???#???..????.?.. 6,1,1
                #?#??#?#.?##??????#. 1,6,2,4,1
                ???##???#?#??#?#?.# 6,4,1,1,1
                #????#?????.#? 6,1,1
                .???#?????.?##?###?? 3,6
                ??????#??.#. 1,7,1
                #????#???.#???? 3,1,1,1,1
                ?.#?.?????.?##???. 1,5,5
                ??????????.#?? 1,6,1
                ??#.?.????#????? 1,1,1,6,1
                ???##??#?#??.??? 11,1
                ?.?.????#?# 1,3,3
                ??.???????????? 7,1
                ????.?#?..????#??? 1,2,2,3
                .??.#?.??????.?#? 2,1,5,3
                ##??????????##? 6,1,4
                .??#??.??#. 4,1
                ?#????..??.?# 4,2,1
                ??#?#?.?#?? 5,2
                ???.?????#??###??#? 3,11,1
                .#???.????. 2,1,1
                ????##?????##?? 6,4
                ?????.?#?#?? 1,3,1,3
                ..???.?#.?? 3,1
                ?????????##? 2,1,6
                ?.####???#?#?#. 5,2,1,1
                ?.#?????#???#.?## 1,1,8,3
                ???.??????#?? 1,4,1,1
                ???????????. 2,4
                .??.????#??.???. 1,7,1
                ??.???#???.?#?? 1,2,1,1,1
                ??##?.?.?.????#? 1,2,1,2,1
                #???#??#?#?.?.?????# 1,5,2,1,3,2
                ??#??.??.?#? 4,3
                ???..#?#?#??? 1,5,1
                ???#?#?????? 6,1,1
                ????..?###?.??#???. 2,4,2
                .???.??#?#???? 1,8
                ???...???###?#??##? 1,1,1,10
                ????#.#.?#?#?????.?? 1,1,1,5,1,1
                ??#???????? 4,5
                ????###???.###?.?#? 9,4,1
                ?.???#??#???#?.?? 2,1,4,2,2
                ??.???#..?..??#. 1,1,1,1,3
                ?#????..??????. 1,2,1,1,1
                ##?###?#?#???#?. 12,1
                ???????????#.??# 3,1,1,1,3
                ????#??#?#?????? 1,6,3
                ?#???#??#.????# 7,1,1,2
                .???###?????#????# 6,2,3,1
                ??#?#?????##????. 3,1,1,2,1
                .#????##?##?? 1,6
                ....????#?##?? 2,1,3
                ?..????#?...?? 2,1
                ?.###??.#???###?? 1,4,9
                ??.??#?.#? 1,2,2
                ???#??????#? 1,1,1,1
                ??.#??#??????#?? 2,1,4,1
                ?..?.???##?##??#? 1,11
                .#?#.#?.?##?..??? 1,1,1,4,1
                ??.???##??###????? 1,1,11
                ???#???.?..?# 4,1,1
                ???###??#???#???#??? 15,2
                ??##?????????? 3,1,3
                .??.??????#? 1,1,2,1
                ??.??##.?#?# 2,3,3
                ?..???#??#? 1,1,4
                ????#?#.?#?..#???? 5,1,2
                ????.?#????????????? 3,3,1,6
                ???#??#?#??##??###?? 1,1,4,9
                ???????.???###?#?#. 1,9
                .???#???.?????? 1,2,1,1,1
                #????.?..????#? 1,3,2,2
                ###?#??####.?????? 11,1,2
                ##????..#.? 3,1,1
                ?#?##??#?? 6,1
                .##??????? 3,3
                ???????.?????##???. 2,1,1,1,5
                ?#.?????????#?.?.??# 1,1,7,1,1
                #???#???#?????#?. 2,1,3,1,2
                ?#??#?????###??.#.# 2,2,1,5,1,1
                ??#?#?.?#?##????. 1,1,1,6
                ?#????.?????. 1,2,1,1
                ?????#.?.#. 5,1
                .#?#??...?#?????.. 4,6
                ???.#??##??#??.??? 2,8,1
                ???#??#?.???#?. 1,3,2,1
                ??#??.?.????#.. 3,1,1,2
                .??#?.???#?..#.??#? 4,4,1,3
                ##?.????.?##?????. 2,2,5,1
                ??#.???????#?#? 2,1,1,5
                ?#????????#? 2,1,2
                ?.??#????#?.?? 1,1,4,1
                ??#??.???.?#?? 4,1,3
                ?...??????? 1,3
                ?#.#?.?#?.####?.## 1,1,1,4,2
                .?????#???.?# 2,3,1,1
                ???#?.??#?.? 1,1,1,1
                ???.????#???#?. 1,7,2
                ?.????#..? 1,3
                #?.????????#?.???# 2,3,2,2,2,1
                ?.#?#??#?.? 1,2,1
                .??##??????#???#.? 1,2,1,6,1
                .???.???.. 1,1,1
                ???#????#??#? 1,3,1,3
                ?.?##????? 2,2
                ??.?#?.???. 1,2,2
                #????????.?????##??? 1,2,1,1,2,6
                .?.#.##??????? 1,1,7,1
                ??.?.???.?? 2,3
                ??.##???.???? 1,3,1,1
                ..#?.???#???.?.?#?? 1,7,3
                ????#?#?????? 7,1
                #?.????.??.??##. 2,1,2,3
                ??#??#####?? 2,8
                ?.?#?#????????.?##? 1,3,4,4
                ?.?#????.?.. 1,2,1,1
                ??????????.##..?##. 9,2,3
                ???.?.??##???.?? 3,1,4,1,1
                ####????#?#????#?.?? 6,2,7,1
                ??#??#??.?????##? 1,1,4,5
                ??????????#?????? 3,1,3,3
                ??..?#????? 1,4
                ??.#.???.??? 1,3,1
                .?????#??..?????# 3,3,1,1
                .???.?????#?#?? 1,8
                .??????.?????? 1,1,1,3
                .??.????##?? 1,2,3
                ?#.??#?.?.#??#????? 1,4,8
                ??#?#.?.#??##???#??? 4,1,1,4,3
                ???????.#.?.?##? 3,1,2
                #..???##??#?####?? 1,1,12
                ??.#.?#???#??? 2,1,2,5
                ?.?##?.??.??. 2,1
                ?###?#????##???? 3,1,3,2
                ??.??#??##????? 1,2,5,1
                ?????????## 1,8
                ?.??#??#??.#???????# 1,2,1,1,9
                ???#?????##????. 4,6
                ??.#????????.#??#?? 1,1,5,1,1,1
                ???##???##????? 1,11
                #??#.??.???. 1,1,1,1
                ???.???????? 2,4
                ???#?...#??. 3,3
                ?.#?.?...???##?#??? 2,8
                ???.?#??.??#????#?? 1,10
                ??.??????????? 5,3
                ??##???##????????.? 5,2,5
                ??????#.??? 3,2,2
                .#??#.####?#??????.? 1,2,12,1
                ?????#??#??.??.?#? 4,2,1
                ???##?#?.?##.#?? 1,6,2,3
                ?##???..???#??### 3,1,2,1,4
                ???.???????.#?#???? 3,1,1,1,1,3
                .?.??????.?.?##? 5,3
                ?..#??.???? 1,2
                .??##.???. 2,3
                ???.??.??????..?#? 1,1,1,1,3,2
                ??.?????.??? 1,5,1
                ?##???#??.?.???? 7,4
                ?.?#?#???.?????. 4,3
                ..???.?????. 3,2
                .??#???#.?????. 3,1,1
                ##?.?#??#????.#??##? 2,5,2,6
                ?????#?.??? 4,1,1
                ?.???#?.??#.? 2,2
                ??#.??###??#?.?. 2,6,2,1
                ??#.????#.???. 3,1,1,1
                ...????#?? 1,2
                ?###?.##?.#?#??? 4,2,4
                .??.??#??#??#? 2,3,1,2
                ?#?.???????#.? 1,6
                ?????????.?? 2,4,1
                .???#????????? 1,3,1,3
                .#??.#????#????#?# 3,1,2,1,1,1
                ??###????#????? 1,8,2
                ????#??#.??#? 1,5,2
                .?#??##??#?#?.##.??? 3,2,4,2,1,1
                #????.#?.???.??..? 4,2,1,1,1
                ??.??.????.?#?. 1,1,3,2
                ?#?.#?.?...????. 3,2,1,1
                ?#?#?.??.? 4,1
                ??????##???##??? 1,9
                ??.??#.??#??????# 2,2,6,1,1
                ??#???????##?. 1,1,2,4
                ?????##???#????#. 1,5,4,1
                ??#???#?????#?##???? 2,4,7,1
                ??.??.#??? 2,1,2
                ?????#??????#?.? 7,2,1
                ?.#??#?..#.?.? 4,1
                ??.??.#????? 2,1,2
                ??.?##??#?#??# 2,7
                .?#.?..??.???##.?.? 2,4
                .????????? 4,1
                ??#####??#???? 10,1
                .?.?.#?#?#??##? 1,1,1,2,3
                ???.#??????# 1,3,4
                ??#?????????????.?. 6,2,2,1
                ?????#????? 2,1,1
                ???#?#????#.?#?? 1,4,1,1,1
                ????#????##????#???? 3,2,5,2,1
                .?.?.#?#???.?.? 1,1,6,1,1
                ?#??.???#?# 3,4,1
                .??????##?..? 2,4,1
                ?#???#?.???##??.? 3,2,5,1
                ??#???##???#??#?#? 8,2,1,2
                #?#???#?##??#? 4,8
                ???.?????...??##??? 1,1,2,1,1,4
                ?.#?.?#.?##????#? 1,2,2,4,1
                .??.?.?????#?##??.# 2,1,2,8,1
                .#?###.???.??? 5,1,1
                ???.?????#??? 2,2,3
                ??.##.?##.#.? 1,2,3,1
                ???#?#?#??# 6,2
                ??..??#??#?#???.#??# 2,9,1,1
                ??.??#???. 2,4,1
                ????.??#?.?? 2,3
                ???????##?#??#?????. 1,9,5
                ??#??????? 2,1,1
                ?????????????#?#?# 1,1,1,7,1,1
                .??.#.???#?#??#???? 1,1,1,6,1
                #?.???#??? 2,4
                ?????????? 4,1,1
                ???.?#.???.?## 1,2,2,3
                ?.??.???##??##.??..# 1,1,7,2,1
                ?..?#??####??###?? 1,13
                .???#????#?.?? 6,2
                ????.#?##.???. 3,4,1
                ..#???????#.????? 1,6,1,1
                ???#??#..#????.?.#? 3,1,5,2
                ??????.????.#?#. 5,2,3
                ?.##??????#?##???? 1,2,1,9
                #.#?#?.?##?#?##. 1,3,8
                ?#?##????? 2,6
                ????.#..???#?? 1,1,1,6
                #.#.???##?????#??? 1,1,1,2,5,1
                ??????????????.. 5,1
                ????????##????#???? 1,1,10
                ?.?????.##?.#.???? 1,2,1,2,1,1
                .?.#????##?.?.?.?.? 1,7,1,1,1
                ..???#..?#????#?.?? 1,1,4,2
                ?.??.??.#?...#? 2,1,1,1
                ?#??.?#??.???#???? 2,3,5
                #..#?#.?..??.#?###? 1,1,1,1,1,5
                ??.??.?..#.? 2,1,1,1
                ???#?????# 2,2,3
                ?????.??#?. 1,1,3
                ??..?###???????. 1,10
                ??#????.??#????.?? 7,5,1
                .??????#??????#. 2,4,2,1,1
                ???.???#?????#.# 2,10,1
                ?#?..??.##? 2,2,2
                .#?????.??? 1,1,3
                ?#?#.??###??#???.?? 1,1,5,1,1,1
                .??.????.# 1,1,1
                ?????#??????##?#?.?? 6,7,2
                .?.??.??????#?#??? 2,11
                ?#??#????.??#?. 2,1,1,3
                ?#??.????#?##???#? 3,1,1,1,2,2
                ??#?#?.#?? 5,1
                ?#?.????#???????##?? 2,4,1,3
                ?#?#????????#?? 1,1,1,5
                #??.?#?.?????? 1,3,2,1
                .??????????????? 1,2,5
                ?#??#?.??? 1,3,1
                ###???????#?..???? 5,2,1,1,2
                ?#??#???#??.#??.?? 9,2,1
                #??#?..??.. 5,1
                #???????..??? 1,1,1,2
                ??#??.????#?#??#???. 2,1,1,6,1
                .#.?#???.???? 1,2,1,1
                ?.#????.#?? 2,1,2
                ??#?????#?#?#.?? 3,4,1,1,2
                ?#??#?.?????? 5,2
                ??????#?.#.# 6,1,1
                ???????...???##???.. 2,3
                ?.#.#..#?.?#??? 1,1,2,2,1
                ?#??.?????#?.?# 3,1,5,1
                ?#???.??#?? 5,1
                ?.???.#.?#.???##? 1,1,1,6
                ?.?##??????? 1,4,3
                ???.????..?.?#??#. 1,1,1,1,5
                .????##??????#? 5,5
                ???.?##?.?#?##?????. 2,2,2,4,1
                ?????#?????????.?? 7,2,1
                .??#???????#???? 3,8
                ????.?#..#???? 2,1,5
                ?.?##????????#???.? 4,10
                ???#????#?#??.?.#. 13,1
                #?.??#??#?#????? 1,1,7,1,1
                ..#??.??????????? 1,5
                ???.#?.??????????.? 2,3
                ??.??????..#? 1,4,1
                ????#??#???????#???# 16,1
                ?????.##??????? 2,1,3,2
                ???.#?##?#????##.??? 1,12,1
                ?##?????#??##???#?? 4,7,2
                .#?#??.??#?.? 5,2,1
                .?##??.?#??.??? 4,1,1,1
                ??.?..?????????##??. 1,6
                ??#???#?##?????? 2,1,1,6,1
                ?#..#.????.?#? 2,1,2,3
                ?#????#????? 1,5
                .???????#?##???## 4,4,4
                ??#???????#??.??.? 13,1
                ?#?#.???##??#?#???? 1,1,5,4,1
                ?.???#?#??##??.??? 11,2
                ??##??.???#?#???? 3,9
                .??.??#???.#?#??... 2,3,1,1,1,1
                ??.#?????#?#..? 1,5
                ?????#??#?????.???? 11,1
                ???????.???? 5,2
                ##??#?#..?.?#. 5,1,1,2
                ????#?###??# 8,1
                ?.???.?#??#??#??? 1,2,5,1
                ?###?#??#?#?#?#?. 11,1,1
                ??#??????????#????#? 3,1,7
                ?.????#?.#? 4,2
                ???.#?#?.?#?.? 1,4,3,1
                .???..????.?#?? 3,2,3
                ?.?#.#?#?.????#? 1,1,1,1,4
                ?.?.??..#????#?## 1,1,2,6
                ???#???.#?.#?#?? 6,1,5
                ?#??????.?#? 3,1,1,2
                .??#....#?? 1,1
                ????.##?##???? 3,2,4,1
                ...##???##??????.??# 2,7,3
                ??#??##??..???.? 7,3
                ?#??.#.?.#?. 3,1,1,2
                ????????.?#?? 2,2,3
                ????.?.???#??? 1,1,3
                ???????????.??? 1,6,1
                ???#?.????. 4,1
                ?????????? 4,1,1
                ?.???#?.????#???#? 5,9
                #?#???.?????? 4,4
                ?#??#??.?##. 3,1,2
                #?##?#?#??#?##????? 15,2
                ??????.?#??????#?# 1,1,2,1,1,3
                #.???..?..##?? 1,2,1,4
                .?#...????#?????? 2,4
                ???????????##? 1,2,2,2
                ???#???#?????#?#? 1,6,1,2,1
                .##?????##?#???? 2,1,7
                ??.?.?.??.#????.?.?? 2,1,1,4,1,1
                .?.??#?##?###.?#?#? 10,4
                .???#?#?.??????## 4,3
                ?.??????????? 1,5
                ?#???#.??#?.? 6,1,1,1
                ??????.####.???### 4,4,5
                ????????.??#? 3,1,1,4
                ??#??#????.#??.??.? 6,1,1,1,2,1
                ##????#.?.#? 2,4,1
                .???.?.???.????. 3,2,2
                ..?#????..???. 6,1
                #?#?###??. 1,5,1
                #?.?.??????#?? 1,1,1,3
                ?.???????#?#? 1,2,2,1
                ??#???##??#??.?##??. 10,1,2,1
                ??#...#?#??????##?. 1,6,4
                ?#?.??.#?? 2,1,1
                ?#.???.?????????#. 2,1,1,1,1,2
                ?.?????###?#.#?? 10,1
                ???##???#? 4,3
                ??.?????.?? 1,5,1
                ???##?#?##?????.? 6,2,1,1,1
                #.#??????##??# 1,1,7,1
                ???#.?????.??#? 3,3,2
                ????????#??#???? 4,1,1,1,1
                .#?.??.?#?#??# 1,1,3,1
                .?.?#?#.?#???????#? 3,3,1
                ?????#???. 1,4,2
                ??#.#.??..??###?? 1,1,2,5,1
                ?#????????????? 6,2,2
                .#?.#????????? 2,4,1,2
                ?..???.?.?## 1,1,1,2
                ??#??????? 5,1,1
                #?.??#?????..? 2,2,1,1
                ?#??##???#.#?.?????? 7,2,2,1,3
                ???.?#??#?#???? 1,5,1,1
                .???####?????##??.?? 8,4
                .??.??#??????#? 4,5
                .?????????.? 2,1
                .???#?????? 5,1
                ???..#?.##??? 1,2,3,1
                ???#????.?. 2,1,1
                #?????##??.? 2,2,3,1
                #?#??##???????.#...? 1,6,2,1,1,1
                .???????#?.? 5,3
                ?##???????..?? 5,2
                ??#.??.##.?## 2,1,2,2
                ?..?#.?#.?.??#? 2,1,3
                ?#..??..#??#? 1,2,4
                ##??.#?#?#? 2,5
                .#????#??.?.??? 2,3,1,2
                #.?#??.?#??????????. 1,1,1,1,7,1
                ??.#..##????##?????? 1,1,4,2,2,1
                ????#?#???# 4,5
                ??????.??? 1,1,1
                ??#?.??#.#?#??.??# 4,2,5,1
                ??###?#..?????#??.? 7,1,3,1
                ????????.??#?? 6,1,2
                ?????????.?#? 3,1,2
                ???.???#.###?#???# 1,1,1,1,9
                #.#??.??#???..? 1,2,4,1,1
                ..?????#??#?#? 3,3,1,1
                ????.?#?????? 2,2,3
                ??#.?????.. 3,2,1
                ?.##??#...# 5,1
                ?????#?..?####?. 4,4
                ???#?.?##??????## 5,2,5
                .??#?.????#.??#. 1,1,1,3,1
                ??#???#?#??#?#. 1,1,3,4
                ?????#?.???#?.? 4,3
                ????.????#? 1,6
                ??#??#?#??????.???? 8,1,1,1,1
                ?.?.?.##?#??#?? 1,8
                ??#?..??##?#. 1,6
                ?#?.????#..????# 3,4,4
                ??#??#????#?.#?.# 1,6,3,1,1
                ?##?#?#.#?.??#??#?? 5,1,1,1,2,2
                ?#?.#.#?#?.#???? 3,1,4,2,1
                .##.??#????##.??# 2,5,2,3
                ..???.??.????? 2,4
                #.?#??????? 1,2,3
                #?????#.#?.???. 1,1,2,1,3
                #??.??????#?????.?. 2,7,2
                ??#.???##? 1,2
                #.####?#??. 1,4,2
                ???.#?#??#. 3,3,1
                ???#??#?#???#?.???. 1,6,1,1,1,1
                ??..????#???#????#?? 1,13
                ?.?##.#??????? 3,1,2
                #????#.??.????##? 3,1,2,1,2
                ?##??.???#?#??? 3,1,1,3,2
                #?#???????.#?#?????? 6,1,1,2,1,1
                ???#???.?????#. 1,5,2,1
                ???#???#?#?.??###.. 4,3,4
                ??????????# 6,1
                ?#.??.??#?? 1,1,2
                #?#??????#??#?? 3,8
                .???.?####.? 1,5,1
                .#??.?????#?..?. 2,7,1
                .?????#?#? 1,1,1
                .????#??.?.?# 1,2,1,1
                #?????#?..?#? 2,4,2
                ?#?.?..#???? 1,1,1,2
                #.?.???#???? 1,1,1,4
                ????#???.??? 5,1
                ???.?#???##.. 2,3,2
                .??.????#.?.? 1,2,2,1
                .#?????#???????#???? 1,1,1,8
                ?#?.?.?#??? 2,3
                ?????.???#. 1,1,4
                .????.??#.??..?.??#? 2,1,1,2,1,3
                .????.?#?#.#?#???#? 3,2,1,5,1
                ?????..#???????? 3,5,2
                ?.???##??????? 1,7
                ???#??????????# 1,1,1,3,2
                ??.#?#?????? 1,6
                ??.?????????.##???## 1,1,3,1,3,3
                ?.?##??.?.?.??##? 4,3
                ????..??..?? 1,1,2,1
                #????????...#?????# 9,1,1,1
                ?#?#?????#####??? 1,1,11
                ?#???.?????? 4,2,2
                ?#???#??????.?? 9,1,2
                ?#???#.?.#.?? 5,1,1,1
                ?????#?##????.#???.? 9,2
                ?.??#??#?#?#?#? 1,10
                ?#???.?..#? 3,1
                ?????.#?.??#??? 3,2,2
                ??#???????.?#??###?? 7,6
                #????.?##??. 3,1,2
                ??.?#????????#???? 1,2,1,4,1
                #??.??????????? 1,4,1,1
                ????????..??# 2,1,1,1
                ?#?????##???#? 2,7
                ?#.??#?#.?##??# 1,4,4,1
                #?????#??#????#??## 1,6,2,3,2
                ?.??????#???#???. 1,7,2
                .????.??.???#?????# 4,1,2,1,1,3
                #??##?##?.? 1,7
                ???#?????.?.??? 1,1,3,1,3
                ??##??????#.??? 3,5,2
                #??..???#?##? 1,1,1,4
                #??#??????#???.??## 2,1,2,2,1,4
                ??#.??.?## 3,2,2
                .#???????##??#???? 2,10,3
                .?#..?#??? 1,3
                ..???.#?.#??##??## 1,1,9
                ??????.#??#?. 3,1,2
                ?##?###??#???#?. 9,3
                ????.?.????? 1,1,1,1
                ??.?.????#??#?? 1,1,1,6
                .????.?.#? 3,1
                #..????#?..??????? 1,6,1,1,1
                ?.???????.. 1,1,2
                ????????????#? 2,2,1,1
                #?#??#????? 1,4,2
                ?..#?#???.. 1,1,3
                ?????.??.?????#? 3,1,1,6
                ????.####??? 2,6
                ?#.??????? 1,2,1
                .#??..???. 1,3
                ?#??#???#??????????? 1,4,1,3,1,1
                #?.???#?##?.#? 1,1,4,1
                ?####??????#?????? 5,2,2,3
                ???###???#?????#???? 12,3,1
                ?.????????#?#??????? 3,9,3
                ?????#???.? 4,1
                ????#?#?####????. 1,11,1
                #.????#???????.?? 1,2,8,2
                ????#?##??#?? 1,1,6
                ???#.????. 3,1
                .??#????#??? 5,1
                ?????????????? 3,5,1
                ?#?.??.????#??? 2,3,1
                ?.#??.??????#? 1,8
                ??#..????.?.???? 2,1,1,1,2
                ?#?...?#?#?#?. 1,5
                ??????#?????? 1,8
                ?.??.??.??#????. 2,1,6
                ??????#??..??#??? 7,2,1
                .#?.#?#.??#. 1,1,1,1
                ??##?##.????? 7,2,1
                ?#???#????#?????.. 6,5
                ?.????????????## 1,10
                #..?????#? 1,1,5
                ??????.????. 4,1
                ...##????????#?. 6,2
                #.?#??????..#?.?# 1,6,1,2,1
                #.???.?##?????#? 1,1,3,4
                ?#..#?????.??.?.?# 1,3,1,1
                ???????????##?????? 1,1,14
                ??????????????#?##.. 3,12
                ???#???????????#???? 5,8
                ???.#??.#? 1,1,1
                ??.???.?????? 1,1
                #.#.??#???#?? 1,1,8
                .???.?.???##????? 1,1,1,2,7
                ??#??#??##.??.?#?? 10,1,4
                ##.??#???#???#.. 2,6,1
                ?..????#?.????.?? 1,6,1,1
                ?#???.?.??.#? 2,1,1,1
                ?.?.????##??#??.#. 1,1,8,1
                ??####?#??# 5,1,1
                ???##?#??####?? 1,10,1
                .??????#??.#.#.?? 1,5,1,1,1
                ??????.????#?#?##??# 1,1,1,1,3,7
                #????#?#??????.? 12,1
                #.?#?.?.??#?##?## 1,1,1,8
                ???#??#?????#..??? 7,5,2
                ??##?????????#..??? 1,4,7,2
                ???##???.????? 5,4
                ????.???.?????????# 3,2,2,2,2
                ?..#??#??#?..#? 8,1
                .????.?????? 2,2
                ??..????????? 1,1,2,1
                ?#?#??.????? 1,1,1,1
                .#?.?.?##.?. 2,2
                ???????????#. 2,2,4
                .??#??#????#?.#.#?.# 9,1,1,2,1
                ??##?.?.#?????.? 3,6
                ?#?#??#?..??? 4,1,1
                .???..#??.?#? 2,1
                ???##????.#.?? 2,2,1,1
                ##?#..#?.?.? 2,1,2,1
                ?????#?????#?# 1,1,7
                .??..????#???. 2,6,1
                #?????##??????#??. 4,2,1,5
                ?.?..????#??? 1,1,5
                ??.???????.??? 6,2
                ??????.????.. 2,1,2
                ?????.?.?#?#?? 1,1,4,1
                ?.??.?#???#? 2,1,2
                ??#????#??? 1,3
                ????????.?##?. 3,3,3
                ??#?#????.????#??? 1,7,1,2,1
                ????.??????#? 1,1,5,2
                ????.???#?.?##???.? 1,3,6
                ?.##?##?..##? 6,2
                ??.??????.??? 1,6,1
                ??#?.?.????# 2,2
                .?##?##?#.?????.?? 8,2
                ?.?##??#????#. 7,1
                ?????##???.#. 2,2,1
                ?#?#?..??. 4,2
                ?????.#.?????#???#? 5,1,1,2,2
                ?#?#??..####.. 1,2,4
                #.??##???????#??? 1,5,2,2,2
                ?#???.?#.. 2,1,1
                ??##?#?.?.?#?? 7,2
                ???##??#???.??.?? 8,1,1,1
                #?????#??.?.??? 9,1
                ?????????#???# 5,3,2
                ??.????????#?????? 1,1,4,1,3
                ???.???.?? 1,1,1
                ??.???.??.?..??##.? 1,1,1,1,4,1
                ???##????.?????.# 6,4,1
                ?????#?#.?#? 4,3
                #??#??.???#??????#. 1,2,9
                ?????#??.??? 2,1
                .??.???#??###.???# 2,8,3
                ??#.??.??##?##? 1,2,6
                ?#??.??#??? 3,4
                ?????##????#.#? 1,10,1
                .??#.??#?????.????# 3,5,1,1,1
                ?????#??#?#???.?? 1,9
                .#?????????#?.?.??#? 1,1,7,1,1
                ?##?.???#??.??# 2,5,1
                ??#.???#####??? 2,1,6
                ??????#???.? 2,4,1,1
                #.?##???????#????#? 1,2,1,1,7
                ??##???.??.#? 5,1,1
                ????.##??# 2,3,1
                .????###?.? 2,4,1
                #?????..???##. 5,4
                ..?????????.?#????? 4,4
                .?#.?#??#.#..???. 2,1,1,1,3
                ???.????#?????????. 1,7,5
                ?.?.#?.?#? 1,2
                ##???????#. 3,1,1
                .#???#??##???#.??. 3,9,1
                ?.???#???..?? 1,1,3,1
                ?##???#????##. 2,3,3
                ?#??#.?????.### 4,2,2,3
                ????.#?????#???? 1,1,5,1,1
                #?#?????#??.????#??? 3,3,1,5,1
                ???#?????????#??##? 1,2,8,3
                ...??.?????????.?.. 1,5
                ?##??#?#?????#. 10,1
                ??#??.?????????????? 4,3,6
                ?#?##??#?..???? 5,1,4
                ?#????????##?#??#. 5,7
                ??#????##?? 5,4
                ???????#??#???? 2,10
                ?#.?#???.??#?????#? 2,2,10
                ???##?????#???????? 11,1,1
                ????##????.??#?#??? 1,6,5,1
                #??.?????##?#?? 2,5,3
                ?#?#?#???? 5,3
                .#???#??.??####??#? 1,1,1,9
                .???.??????? 1,6
                ??#??.???#?#?????##. 4,4,2,2
                ##?#?.??#? 5,1,1
                ?#????#?.????.? 4,1,4
                ?####??##?#?...?#.?? 11,1
                ?..???????.##????# 1,1,1,1,7
                ?#?????????.??. 1,3,1
                ??????????#??? 4,1,1,1
                ?.?#?##?##?????? 5,5,2
                ???##?#??#????#?? 6,2,1,3
                ?.??.#?????????..?# 1,10,2
                #?#.??.??????.????? 1,1,2,3,1,2
                ??.##??#?.???? 1,6,2,1
                ????#??..??..??? 6,1,2
                ??.?##??#?#??##?.?. 11,1
                ??.?????#..##.??#?? 1,4,2,3
                ??#??..??.. 3,1
                ?##???#???????# 3,4,5
                .?.????.?#?##??#? 1,1,8
                .##?????#. 4,1
                ??#??#?????????? 4,1,4
                ??.??.??????? 1,1,1,4
                ?##?????###? 3,6
                ?????????????????# 1,3,1,2,2,1
                ????##?#?#?.#??### 1,5,1,6
                .??..???#???? 1,2,1,1
                .?.??.?.?? 1,1""";*/

        List<Data> corruptedData = mapData(input);
        List<Integer> counts = new ArrayList<>();
        for (Data dataLine : corruptedData) {
            counts.add(countPossibilities(dataLine));
        }
        System.out.println("Possibilities= " + counts);
        Integer sum = counts.stream().reduce(0, Integer::sum);
        System.out.println("Sum= " + sum);
    }

    private static List<Data> mapData(String input) {
        return Arrays.stream(input.split("\n")).map(Advent1201::mapDataLine).toList();
    }

    private static Data mapDataLine(String inputLine) {
        String[] parts = inputLine.split(" ");
        List<Character> dataEntries = parts[0].chars().mapToObj(c -> (char) c).toList();
        List<Integer> sumCheck = Arrays.stream(parts[1].split(",")).map(Integer::parseInt).toList();
        return new Data(dataEntries, sumCheck);
    }

    private static int countPossibilities(Data data) {
        String format = "%0" + data.dataLength + "d";
        List<String> dataSamples = new ArrayList<>();
        double possibilitiesMax = Math.pow(2d, data.dataLength);
        for (int i = 0; i < possibilitiesMax; i++) {
            String generatedSample = generateDataSample(i, format);
            if (checkSampleCompatibility(generatedSample, data)) {
                dataSamples.add(generatedSample);
            }
        }
        return getCount(dataSamples, data.getSumCheck());
    }


    private static String generateDataSample(int value, String format) {
        return String.format(format, Double.parseDouble(Long.toBinaryString(value))).replaceAll("0",".").replaceAll("1","#");
    }

    private static boolean checkSampleCompatibility(String sample, Data data) {
        Map<Integer, Character> fixIndexes = getFixIndexesMap(data);
        for (int i = 0; i < sample.length(); i++) {
            Character character = fixIndexes.get(i);
            if (character != null) {
                char charString = sample.charAt(i);
                if (charString != character) {
                    return false;
                }
            }
        }
        return true;
    }

    private static int getCount(List<String> samples, List<Integer> sumCheck) {
        int count = 0;
        for (String sample : samples) {
            List<String> sampleParts = Arrays.stream(sample.split("\\.")).filter(StringUtils::isNotBlank).collect(Collectors.toList());
            if (sampleParts.size() == sumCheck.size()) {
                boolean check = true;
                for (int i = 0; i < sampleParts.size(); i++) {
                    if (sampleParts.get(i).length() != sumCheck.get(i)) {
                        check = false;
                        break;
                    }
                }
                if (check) {
                    count++;
                }
            }
        }
        return count;
    }

    private static Map<Integer, Character> getFixIndexesMap(Data data) {
        Map<Integer, Character> fixIndexesMap = new HashMap<>();
        List<Character> dataEntries = data.dataEntries;
        for (int i = 0; i < data.dataLength; i++) {
            Character c = dataEntries.get(i);
            if (c == '#') {
                fixIndexesMap.put(i, '#');
            } else if (c == '.') {
                fixIndexesMap.put(i, '.');
            }
        }
        return fixIndexesMap;
    }


    private static class Data {
        List<Character> dataEntries;
        List<Integer> sumCheck;
        int dataLength;

        public Data(List<Character> dataEntries, List<Integer> sumCheck) {
            this.dataEntries = dataEntries;
            this.sumCheck = sumCheck;
            this.dataLength = dataEntries.size();
        }

        public List<Character> getDataEntries() {
            return dataEntries;
        }

        public List<Integer> getSumCheck() {
            return sumCheck;
        }

        public int getDataLength() {
            return dataLength;
        }
    }


}